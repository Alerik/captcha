<div class="main">
  <div class="header-holder">
    <h1>{{name}}</h1>
    <div class="icon-holder" *ngIf="dataset" (click)="selectedIndex = 2">
      <mat-icon class="warn" *ngIf="!dataset.created" matTooltip="Yuru dataset is still being created">warning
      </mat-icon>
      <mat-icon class="alert" *ngIf="dataset.created && !dataset.reviewed" matTooltip="Your dataset is being reviewed">
        pageview</mat-icon>
      <mat-icon class="alert" *ngIf="dataset.created && dataset.reviewed && !dataset.approved"
        matTooltip="Your dataset was not approved">warning</mat-icon>
    </div>
  </div>

  <div>
    <mat-tab-group [selectedIndex]="selectedIndex">
      <mat-tab label="Overview">
        <div class="loader" *ngIf="!dataset">
          <mat-progress-spinner color="primary"
          mode="indeterminate">
         </mat-progress-spinner> 
        </div>
        <div class="card-holder" *ngIf="dataset">
          <mat-card class="info-card">
            <mat-card-header>
              <mat-card-title>Overview</mat-card-title>
              <mat-card-subtitle>100% complete</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <mat-list role="list">
                <table class="overview-table" *ngIf="dataset">
                  <tbody>
                    <tr>
                      <th mat-subheader>Description</th>
                      <td>{{this.dataset.description}}</td>
                    </tr>
                    <tr>
                      <th mat-subheader>Prompt</th>
                      <td>{{this.dataset.prompt}}</td>
                    </tr>
                    <tr>
                      <th mat-subheader>Entries</th>
                      <td>{{this.dataset.entry_count}}</td>
                    </tr>
                    <tr>
                      <th mat-subheader>Annotations</th>
                      <td>{{this.dataset.annotations_total}}</td>
                    </tr>
                  </tbody>
                </table>
              </mat-list>
            </mat-card-content>   
          </mat-card>
        </div>
      </mat-tab>

      <mat-tab label="Entries">
        <div class="loader" *ngIf="!dataset">
          <mat-progress-spinner color="primary"
          mode="indeterminate">
         </mat-progress-spinner> 
        </div>
        <div class="card-holder" *ngIf="dataset">
          <div class="table-container">
            
        <div class="loading-shade" *ngIf="dataSource.loading$ | async" >
          <mat-progress-spinner color="primary" mode="indeterminate">
          </mat-progress-spinner>
        </div>   
            <table #tablur mat-table [dataSource]="dataSource" class="mat-elevation-z8" width="800px"
              multiTemplateDataRows>
              <ng-container matColumnDef="innertext">
                <th mat-header-cell *matHeaderCellDef matTooltip="The text to be annotated">Text</th>
                <td mat-cell *matCellDef="let element">
                  <app-text-entry-row [entry]="element.entry"></app-text-entry-row>
              </ng-container>
  
              <ng-container matColumnDef="querry_total">
                <th mat-header-cell *matHeaderCellDef matTooltip="Number of annotations submitted">Total Querries</th>
                <td mat-cell *matCellDef="let element"> {{element.entry.querry_total}} </td>
              </ng-container>
              <ng-container matColumnDef="accuracy">
                <th mat-header-cell *matHeaderCellDef matTooltip="The agreement of annotations">Accuracy</th>
                <td mat-cell *matCellDef="let element"> {{(element.entry.accuracy * 100)| number:'1.0-1'}}% </td>
              </ng-container>
              <ng-container matColumnDef="certified">
                <th mat-header-cell *matHeaderCellDef matTooltip="If this has been annotated by a trusted individual">
                  Certified</th>
                <td mat-cell *matCellDef="let element">
                  <mat-checkbox [checked]="element.certified"></mat-checkbox>
                </td>
              </ng-container>
  
              <!--Expanding content-->
              <ng-container matColumnDef="expandedDetail">
                <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length">
                  <div class="example-element-detail"
                    [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                    <app-text-index-entry-details [entry]="element" [expanded]="element == expandedElement" width="100%">
                    </app-text-index-entry-details>
                    <!-- <app-text-index-annotation [annotation]="annot"></app-text-index-annotation> -->
                  </div>
                </td>
              </ng-container>
  
              <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
              <tr mat-row *matRowDef="let element; columns: displayedColumns;" class="example-element-row"
                [class.example-expanded-row]="expandedElement === element"
                (click)="expandedElement = expandedElement === element ? null : element"></tr>
              <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
            </table>
            <mat-paginator *ngIf="this.dataset" [pageSizeOptions]="[10, 20, 50]" [pageSize]="20"
              [length]="this.dataset.entry_count" (page)="pageEvent($event)" showFirstLastButtons></mat-paginator>
          </div>
          <p>Upload more entries. </p><input type="file" (change)="fileChange($event)" placeholder="Upload entries"
          accept=".txt" />
        <button mat-raised-button color="primary" (click)="uploadClick($event)">Upload</button>
        </div>
      </mat-tab>

      <mat-tab label="Notifications">
        <div class="loader" *ngIf="!dataset">
          <mat-progress-spinner color="primary"
          mode="indeterminate">
         </mat-progress-spinner> 
        </div>
        <div class="card-holder" *ngIf="dataset">
          <mat-list role="list" class="notification-list">
            <table class="overview-table" *ngIf="dataset">
              <tbody>
                <tr *ngFor="let item of notifications">
                  <th mat-subheader>{{item.recordtime | date: 'M/d/yyyy, h:mm a'}}</th>
                  <td>{{item.message}}</td>
                </tr>
              </tbody>
            </table>
          </mat-list>
        </div>  
      </mat-tab>
    </mat-tab-group>
  </div>